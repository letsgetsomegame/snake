<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Snake on a 10x10x10 Cube</title>
  <style>
    body { margin: 0; overflow: hidden; background: #222; }
    #info { position: absolute; color: #fff; top: 10px; left: 10px; font-family: monospace; z-index: 1;}
    canvas { display: block; }
  </style>
</head>
<body>
<div id="info">
  <b>3D Snake (10x10x10)</b><br>
  Controls: W/A/S/D (X/Z), R/F (Y)<br>
  Eat cubes to grow. Avoid yourself!<br>
  <span id="score"></span>
</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
const SIZE = 10;

let direction = { x: 1, y: 0, z: 0 }; // start moving +X
let snake = [{ x: 5, y: 5, z: 5 }];
let food = randomPos();
let grow = 0;
let gameOver = false;
let score = 0;

function randomPos() {
  while (true) {
    let pos = {
      x: Math.floor(Math.random() * SIZE),
      y: Math.floor(Math.random() * SIZE),
      z: Math.floor(Math.random() * SIZE)
    };
    if (!snake.some(s => s.x === pos.x && s.y === pos.y && s.z === pos.z)) return pos;
  }
}

// --- THREE.js setup ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x222222);

const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(SIZE*1.5, SIZE*1.7, SIZE*1.5);
camera.lookAt(SIZE/2, SIZE/2, SIZE/2);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Cube outline
const boxHelper = new THREE.BoxHelper(new THREE.Mesh(new THREE.BoxGeometry(SIZE, SIZE, SIZE)), 0xffffff);
boxHelper.position.set(SIZE/2 - 0.5, SIZE/2 - 0.5, SIZE/2 - 0.5);
scene.add(boxHelper);

// Snake and food groups
const snakeGroup = new THREE.Group();
const foodGroup = new THREE.Group();
scene.add(snakeGroup);
scene.add(foodGroup);

function drawScene() {
  // Clear
  while(snakeGroup.children.length) snakeGroup.remove(snakeGroup.children[0]);
  while(foodGroup.children.length) foodGroup.remove(foodGroup.children[0]);
  // Draw snake
  for (let i = 0; i < snake.length; ++i) {
    const {x, y, z} = snake[i];
    const geo = new THREE.BoxGeometry(0.9, 0.9, 0.9);
    const mat = new THREE.MeshLambertMaterial({ color: i === 0 ? 0x00ff00 : 0x22cc66 });
    const cube = new THREE.Mesh(geo, mat);
    cube.position.set(x, y, z);
    snakeGroup.add(cube);
  }
  // Draw food
  const {x, y, z} = food;
  const geo = new THREE.BoxGeometry(0.9, 0.9, 0.9);
  const mat = new THREE.MeshLambertMaterial({ color: 0xff2222 });
  const cube = new THREE.Mesh(geo, mat);
  cube.position.set(x, y, z);
  foodGroup.add(cube);
}

// Light
const light = new THREE.PointLight(0xffffff, 1, 100);
light.position.set(SIZE*2, SIZE*2, SIZE*2);
scene.add(light);

// --- Controls ---
window.addEventListener('keydown', (e) => {
  if (gameOver && e.key === ' ') restart();
  if (gameOver) return;
  switch (e.key.toLowerCase()) {
    case 'w': if (direction.z !== 1) direction = {x:0, y:0, z:-1}; break;
    case 's': if (direction.z !== -1) direction = {x:0, y:0, z:1}; break;
    case 'a': if (direction.x !== 1) direction = {x:-1, y:0, z:0}; break;
    case 'd': if (direction.x !== -1) direction = {x:1, y:0, z:0}; break;
    case 'r': if (direction.y !== -1) direction = {x:0, y:1, z:0}; break;
    case 'f': if (direction.y !== 1) direction = {x:0, y:-1, z:0}; break;
  }
});

// --- Game logic ---
function step() {
  if (gameOver) return;
  let head = Object.assign({}, snake[0]);
  head.x = (head.x + direction.x + SIZE) % SIZE;
  head.y = (head.y + direction.y + SIZE) % SIZE;
  head.z = (head.z + direction.z + SIZE) % SIZE;

  // Collision with self
  if (snake.some(s => s.x === head.x && s.y === head.y && s.z === head.z)) {
    document.getElementById('score').innerHTML = `<b>Game Over!</b> Score: ${score} <br>Press SPACE to restart.`;
    gameOver = true;
    return;
  }

  snake.unshift(head);

  // Eat food
  if (head.x === food.x && head.y === food.y && head.z === food.z) {
    grow += 2;
    score += 1;
    food = randomPos();
    document.getElementById('score').innerText = `Score: ${score}`;
  }

  if (grow > 0) {
    grow--;
  } else {
    snake.pop();
  }
}

function restart() {
  direction = { x: 1, y: 0, z: 0 };
  snake = [{ x: 5, y: 5, z: 5 }];
  food = randomPos();
  grow = 0;
  score = 0;
  gameOver = false;
  document.getElementById('score').innerText = '';
}

function animate() {
  drawScene();
  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}
animate();

setInterval(step, 160); // Game speed

</script>
</body>
</html>
